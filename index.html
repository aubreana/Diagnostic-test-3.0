<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>English Adventure Test</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800;900&family=Fredoka:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #FEF9F3;
      --fg: #2D3436;
      --accent: #E17055;
      --accent-2: #00B894;
      --accent-3: #FDCB6E;
      --card: #FFFFFF;
      --correct: #00B894;
      --wrong: #E17055;
      --hots: #6C5CE7;
      --muted: #B2BEC3;
      --answered: #74B9FF;
    }

    * { box-sizing: border-box; }

    body {
      font-family: 'Nunito', sans-serif;
      background: var(--bg);
      color: var(--fg);
      min-height: 100vh;
      overflow-x: hidden;
    }

    h1, h2, h3, .title-font {
      font-family: 'Fredoka', sans-serif;
    }

    /* Animated Background */
    .bg-animated {
      position: fixed;
      inset: 0;
      z-index: -1;
      background: 
        radial-gradient(ellipse at 20% 0%, rgba(253, 203, 110, 0.25) 0%, transparent 50%),
        radial-gradient(ellipse at 80% 100%, rgba(0, 184, 148, 0.2) 0%, transparent 50%),
        radial-gradient(ellipse at 50% 50%, rgba(225, 112, 85, 0.1) 0%, transparent 70%),
        var(--bg);
    }

    /* Floating Bubbles */
    .bubble {
      position: fixed;
      border-radius: 50%;
      opacity: 0.12;
      pointer-events: none;
      z-index: -1;
      animation: floatBubble 25s ease-in-out infinite;
    }

    .bubble-1 {
      width: 400px; height: 400px;
      background: linear-gradient(135deg, var(--accent-2), #55EFC4);
      top: -150px; left: -100px;
    }

    .bubble-2 {
      width: 300px; height: 300px;
      background: linear-gradient(135deg, var(--accent-3), #F39C12);
      bottom: -100px; right: -80px;
      animation-delay: -10s;
    }

    .bubble-3 {
      width: 250px; height: 250px;
      background: linear-gradient(135deg, var(--accent), #FAB1A0);
      top: 40%; right: -100px;
      animation-delay: -5s;
    }

    @keyframes floatBubble {
      0%, 100% { transform: translate(0, 0) scale(1); }
      25% { transform: translate(30px, -40px) scale(1.05); }
      50% { transform: translate(-20px, 30px) scale(0.95); }
      75% { transform: translate(40px, 20px) scale(1.02); }
    }

    /* Progress Bar */
    .progress-container {
      background: rgba(255,255,255,0.95);
      backdrop-filter: blur(10px);
      border-radius: 50px;
      height: 16px;
      overflow: hidden;
      box-shadow: inset 0 2px 6px rgba(0,0,0,0.08);
      border: 2px solid rgba(255,255,255,0.5);
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--accent-2), var(--accent-3), var(--accent));
      background-size: 200% 100%;
      border-radius: 50px;
      transition: width 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      animation: progressGradient 3s linear infinite;
    }

    @keyframes progressGradient {
      0% { background-position: 0% 50%; }
      100% { background-position: 200% 50%; }
    }

    /* Question Card */
    .question-card {
      background: var(--card);
      border-radius: 24px;
      box-shadow: 
        0 4px 6px rgba(0,0,0,0.03),
        0 15px 50px rgba(0,0,0,0.08);
      transform: translateY(20px);
      opacity: 0;
      animation: cardSlideUp 0.5s cubic-bezier(0.4, 0, 0.2, 1) forwards;
    }

    @keyframes cardSlideUp {
      to { transform: translateY(0); opacity: 1; }
    }

    /* Difficulty Badge */
    .difficulty-badge {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      padding: 5px 14px;
      border-radius: 50px;
      font-weight: 700;
      font-size: 0.7rem;
      letter-spacing: 0.5px;
      text-transform: uppercase;
    }

    .difficulty-easy {
      background: linear-gradient(135deg, rgba(0, 184, 148, 0.15), rgba(85, 239, 196, 0.15));
      color: #00A884;
      border: 2px solid rgba(0, 184, 148, 0.3);
    }

    .difficulty-medium {
      background: linear-gradient(135deg, rgba(253, 203, 110, 0.2), rgba(243, 156, 18, 0.2));
      color: #B7820E;
      border: 2px solid rgba(253, 203, 110, 0.5);
    }

    .difficulty-hard {
      background: linear-gradient(135deg, rgba(108, 92, 231, 0.15), rgba(162, 155, 254, 0.15));
      color: #5B4ED0;
      border: 2px solid rgba(108, 92, 231, 0.4);
    }

    /* Category Badge */
    .category-badge {
      display: inline-block;
      background: linear-gradient(135deg, var(--accent), #FAB1A0);
      color: white;
      padding: 6px 16px;
      border-radius: 50px;
      font-weight: 700;
      font-size: 0.75rem;
      letter-spacing: 0.3px;
      text-transform: uppercase;
    }

    /* Option Buttons */
    .option-btn {
      background: #FAFAFA;
      border: 3px solid #E8E8E8;
      border-radius: 16px;
      padding: 14px 18px;
      text-align: left;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
    }

    .option-btn:hover:not(:disabled) {
      border-color: var(--accent-2);
      background: #FFFFFF;
      transform: translateX(6px);
    }

    .option-btn.selected {
      border-color: var(--accent);
      background: linear-gradient(135deg, rgba(225, 112, 85, 0.08), rgba(0, 184, 148, 0.08));
      box-shadow: 0 2px 10px rgba(225, 112, 85, 0.15);
    }

    .option-btn.correct {
      border-color: var(--correct);
      background: rgba(0, 184, 148, 0.12);
    }

    .option-btn.wrong {
      border-color: var(--wrong);
      background: rgba(225, 112, 85, 0.12);
    }

    /* Option Label */
    .option-label {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 36px;
      height: 36px;
      background: linear-gradient(135deg, var(--accent), var(--accent-3));
      color: white;
      border-radius: 10px;
      font-weight: 800;
      font-size: 0.95rem;
      margin-right: 12px;
      flex-shrink: 0;
      box-shadow: 0 2px 6px rgba(225, 112, 85, 0.25);
    }

    /* Navigation Grid */
    .nav-grid {
      display: grid;
      grid-template-columns: repeat(10, 1fr);
      gap: 6px;
    }

    .nav-btn {
      aspect-ratio: 1;
      border-radius: 10px;
      border: 2px solid #E0E0E0;
      background: white;
      font-weight: 700;
      font-size: 0.85rem;
      cursor: pointer;
      transition: all 0.2s;
      position: relative;
    }

    .nav-btn:hover {
      border-color: var(--accent);
      transform: scale(1.1);
      z-index: 1;
    }

    .nav-btn.current {
      border-color: var(--accent);
      background: linear-gradient(135deg, var(--accent), #F78361);
      color: white;
      transform: scale(1.1);
      z-index: 1;
      box-shadow: 0 4px 12px rgba(225, 112, 85, 0.3);
    }

    .nav-btn.answered {
      border-color: var(--answered);
      background: linear-gradient(135deg, #74B9FF, #0984E3);
      color: white;
    }

    .nav-btn.answered.current {
      border-color: var(--accent);
      background: linear-gradient(135deg, var(--accent), #F78361);
    }

    .nav-btn.correct-answer {
      border-color: var(--correct);
      background: linear-gradient(135deg, #00B894, #26D0A1);
      color: white;
    }

    .nav-btn.wrong-answer {
      border-color: var(--wrong);
      background: linear-gradient(135deg, #E17055, #F78361);
      color: white;
    }

    /* Uncheck Button */
    .uncheck-btn {
      background: transparent;
      border: 2px solid var(--muted);
      color: var(--muted);
      padding: 8px 16px;
      border-radius: 50px;
      font-weight: 600;
      font-size: 0.85rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .uncheck-btn:hover {
      border-color: var(--wrong);
      color: var(--wrong);
    }

    /* Buttons */
    .btn-primary {
      background: linear-gradient(135deg, var(--accent), #F78361);
      color: white;
      font-family: 'Fredoka', sans-serif;
      font-weight: 600;
      font-size: 1rem;
      padding: 14px 28px;
      border-radius: 50px;
      border: none;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 4px 15px rgba(225, 112, 85, 0.35);
    }

    .btn-primary:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(225, 112, 85, 0.45);
    }

    .btn-secondary {
      background: linear-gradient(135deg, var(--accent-2), #26D0A1);
      color: white;
      font-family: 'Fredoka', sans-serif;
      font-weight: 600;
      font-size: 1rem;
      padding: 14px 28px;
      border-radius: 50px;
      border: none;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 4px 15px rgba(0, 184, 148, 0.35);
    }

    .btn-secondary:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(0, 184, 148, 0.45);
    }

    .btn-nav {
      background: white;
      border: 2px solid #E0E0E0;
      color: var(--fg);
      font-family: 'Fredoka', sans-serif;
      font-weight: 600;
      font-size: 0.95rem;
      padding: 12px 24px;
      border-radius: 50px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-nav:hover:not(:disabled) {
      border-color: var(--accent-2);
      color: var(--accent-2);
    }

    .btn-nav:disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }

    .btn-outline {
      background: transparent;
      color: var(--fg);
      font-family: 'Fredoka', sans-serif;
      font-weight: 600;
      font-size: 0.95rem;
      padding: 12px 24px;
      border-radius: 50px;
      border: 3px solid var(--muted);
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-outline:hover {
      border-color: var(--accent);
      color: var(--accent);
    }

    /* Result Card */
    .result-card {
      background: white;
      border-radius: 32px;
      box-shadow: 0 25px 80px rgba(0,0,0,0.1);
      text-align: center;
      animation: resultBounce 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    }

    @keyframes resultBounce {
      0% { transform: scale(0.4); opacity: 0; }
      60% { transform: scale(1.05); }
      100% { transform: scale(1); opacity: 1; }
    }

    /* Score Circle */
    .score-circle {
      width: 180px;
      height: 180px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--accent-2), var(--accent-3), var(--accent));
      background-size: 200% 200%;
      animation: gradientShift 4s ease infinite;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto;
      position: relative;
    }

    .score-circle::before {
      content: '';
      position: absolute;
      inset: 8px;
      background: white;
      border-radius: 50%;
    }

    .score-inner {
      position: relative;
      z-index: 1;
      text-align: center;
    }

    .score-value {
      font-family: 'Fredoka', sans-serif;
      font-size: 3.5rem;
      font-weight: 700;
      background: linear-gradient(135deg, var(--accent), var(--hots));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      line-height: 1;
    }

    @keyframes gradientShift {
      0%, 100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }

    /* Level Badge */
    .level-badge {
      display: inline-block;
      padding: 12px 32px;
      border-radius: 50px;
      font-family: 'Fredoka', sans-serif;
      font-weight: 600;
      font-size: 1.2rem;
    }

    .level-beginner { background: #FADBD8; color: #C0392B; }
    .level-basic { background: #FCF3CF; color: #B7950B; }
    .level-intermediate { background: #D4EFDF; color: #1E8449; }
    .level-advanced { background: #D6EAF8; color: #2471A3; }
    .level-expert { background: #E8DAEF; color: #7D3C98; }

    /* Stats Grid */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
    }

    .stat-card {
      background: #FAFAFA;
      border-radius: 14px;
      padding: 14px;
      text-align: center;
    }

    .stat-value {
      font-family: 'Fredoka', sans-serif;
      font-size: 1.6rem;
      font-weight: 700;
    }

    .stat-label {
      font-size: 0.7rem;
      color: var(--muted);
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    /* Legend */
    .legend-item {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 0.75rem;
    }

    .legend-dot {
      width: 14px;
      height: 14px;
      border-radius: 4px;
    }

    /* Confetti */
    .confetti {
      position: fixed;
      pointer-events: none;
      z-index: 1000;
      animation: confettiFall 4s ease-out forwards;
    }

    @keyframes confettiFall {
      0% {
        transform: translateY(-100vh) rotate(0deg) scale(1);
        opacity: 1;
      }
      100% {
        transform: translateY(100vh) rotate(1080deg) scale(0);
        opacity: 0;
      }
    }

    /* Screen transitions */
    .screen {
      display: none;
      min-height: 100vh;
      padding: 16px;
    }

    .screen.active { display: block; }

    /* Mascot */
    .mascot-container {
      animation: mascotFloat 3s ease-in-out infinite;
    }

    @keyframes mascotFloat {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-12px); }
    }

    /* Modal */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.5);
      backdrop-filter: blur(4px);
      z-index: 100;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s;
    }

    .modal-overlay.active {
      opacity: 1;
      visibility: visible;
    }

    .modal-content {
      background: white;
      border-radius: 24px;
      padding: 28px;
      max-width: 400px;
      width: 100%;
      transform: scale(0.9);
      transition: transform 0.3s;
    }

    .modal-overlay.active .modal-content {
      transform: scale(1);
    }

    /* Reduced motion */
    @media (prefers-reduced-motion: reduce) {
      *, *::before, *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
      }
    }

    /* Mobile */
    @media (max-width: 640px) {
      .nav-grid {
        grid-template-columns: repeat(6, 1fr);
        gap: 5px;
      }

      .nav-btn {
        font-size: 0.75rem;
      }

      .option-btn {
        padding: 12px 14px;
        font-size: 0.9rem;
      }

      .option-label {
        width: 32px;
        height: 32px;
        font-size: 0.85rem;
        margin-right: 10px;
      }

      .score-circle {
        width: 150px;
        height: 150px;
      }

      .score-value {
        font-size: 2.8rem;
      }

      .stats-grid {
        grid-template-columns: 1fr;
      }

      .btn-nav, .btn-primary, .btn-secondary {
        padding: 12px 20px;
        font-size: 0.9rem;
      }
    }
  </style>
</head>
<body>
  <!-- Animated Background -->
  <div class="bg-animated"></div>
  <div class="bubble bubble-1"></div>
  <div class="bubble bubble-2"></div>
  <div class="bubble bubble-3"></div>

  <!-- Start Screen -->
  <div id="startScreen" class="screen active">
    <div class="max-w-lg mx-auto pt-6 md:pt-12">
      <div class="text-center mb-6">
        <div class="mascot-container mb-4">
          <svg width="120" height="120" viewBox="0 0 120 120" fill="none" class="mx-auto">
            <ellipse cx="60" cy="75" rx="40" ry="35" fill="url(#bodyGrad)"/>
            <circle cx="60" cy="45" r="38" fill="url(#headGrad)"/>
            <ellipse cx="47" cy="42" rx="9" ry="11" fill="#2D3436"/>
            <ellipse cx="73" cy="42" rx="9" ry="11" fill="#2D3436"/>
            <circle cx="50" cy="40" r="3" fill="white"/>
            <circle cx="76" cy="40" r="3" fill="white"/>
            <path d="M45 58 Q60 75 75 58" stroke="#2D3436" stroke-width="3.5" fill="none" stroke-linecap="round"/>
            <ellipse cx="35" cy="54" rx="8" ry="5" fill="#FAB1A0" opacity="0.5"/>
            <ellipse cx="85" cy="54" rx="8" ry="5" fill="#FAB1A0" opacity="0.5"/>
            <ellipse cx="60" cy="14" rx="22" ry="10" fill="url(#hatGrad)"/>
            <rect x="42" y="8" width="36" height="10" fill="url(#hatGrad)"/>
            <polygon points="60,2 62,7 67,7 63,10 65,15 60,12 55,15 57,10 53,7 58,7" fill="#FDCB6E"/>
            <defs>
              <linearGradient id="headGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" style="stop-color:#FFEAA7"/>
                <stop offset="100%" style="stop-color:#FDCB6E"/>
              </linearGradient>
              <linearGradient id="bodyGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" style="stop-color:#74B9FF"/>
                <stop offset="100%" style="stop-color:#0984E3"/>
              </linearGradient>
              <linearGradient id="hatGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" style="stop-color:#FD79A8"/>
                <stop offset="100%" style="stop-color:#E84393"/>
              </linearGradient>
            </defs>
          </svg>
        </div>
        
        <h1 class="title-font text-3xl md:text-4xl font-bold mb-2" style="color: var(--fg);">
          English Adventure Test
        </h1>
        <p class="text-base md:text-lg text-gray-600 mb-1">
          Test your English before traveling!
        </p>
        <p class="text-sm text-gray-500">
          30 random questions from 50 question bank
        </p>
      </div>

      <!-- Info Cards -->
      <div class="bg-white rounded-3xl p-5 md:p-6 shadow-lg mb-6">
        <div class="grid grid-cols-3 gap-2 mb-5 text-center">
          <div class="bg-green-50 rounded-xl p-3">
            <div class="text-xl mb-1">üü¢</div>
            <div class="font-bold text-green-700 text-xs">Easy</div>
            <div class="text-xs text-gray-500">~10 soal</div>
          </div>
          <div class="bg-yellow-50 rounded-xl p-3">
            <div class="text-xl mb-1">üü°</div>
            <div class="font-bold text-yellow-700 text-xs">Medium</div>
            <div class="text-xs text-gray-500">~10 soal</div>
          </div>
          <div class="bg-purple-50 rounded-xl p-3">
            <div class="text-xl mb-1">üü£</div>
            <div class="font-bold text-purple-700 text-xs">HOTS</div>
            <div class="text-xs text-gray-500">~10 soal</div>
          </div>
        </div>

        <h3 class="title-font font-bold text-base mb-3 text-center" style="color: var(--accent);">
          Topics covered:
        </h3>
        <div class="grid grid-cols-2 gap-2 text-sm">
          <div class="flex items-center gap-2 bg-gray-50 rounded-lg p-2">
            <span>üëã</span><span class="font-semibold text-xs">Introduction</span>
          </div>
          <div class="flex items-center gap-2 bg-gray-50 rounded-lg p-2">
            <span>üçΩÔ∏è</span><span class="font-semibold text-xs">Restaurant</span>
          </div>
          <div class="flex items-center gap-2 bg-gray-50 rounded-lg p-2">
            <span>üè®</span><span class="font-semibold text-xs">Hotel</span>
          </div>
          <div class="flex items-center gap-2 bg-gray-50 rounded-lg p-2">
            <span>üõí</span><span class="font-semibold text-xs">Shopping</span>
          </div>
          <div class="flex items-center gap-2 bg-gray-50 rounded-lg p-2">
            <span>üó∫Ô∏è</span><span class="font-semibold text-xs">Directions</span>
          </div>
          <div class="flex items-center gap-2 bg-gray-50 rounded-lg p-2">
            <span>‚úàÔ∏è</span><span class="font-semibold text-xs">Travel</span>
          </div>
        </div>
      </div>

      <div class="bg-white rounded-2xl p-4 shadow mb-6">
        <h3 class="title-font font-bold text-sm mb-3" style="color: var(--fg);">
          How it works:
        </h3>
        <ul class="text-sm text-gray-600 space-y-2">
          <li class="flex items-start gap-2">
            <span class="text-green-500 font-bold">1.</span>
            <span>Answer all 30 questions at your own pace</span>
          </li>
          <li class="flex items-start gap-2">
            <span class="text-green-500 font-bold">2.</span>
            <span>You can go back and change your answers</span>
          </li>
          <li class="flex items-start gap-2">
            <span class="text-green-500 font-bold">3.</span>
            <span>Click Submit when you're ready to see results</span>
          </li>
        </ul>
      </div>

      <div class="text-center">
        <button onclick="startQuiz()" class="btn-primary text-lg px-10">
          Start the Test
        </button>
      </div>
    </div>
  </div>

  <!-- Quiz Screen -->
  <div id="quizScreen" class="screen">
    <div class="max-w-2xl mx-auto">
      <!-- Header -->
      <div class="mb-4">
        <div class="flex items-center justify-between mb-2">
          <div class="flex items-center gap-2">
            <span class="title-font font-bold text-lg" style="color: var(--accent);">
              Question <span id="currentNum">1</span>/30
            </span>
            <span id="difficultyIndicator" class="difficulty-badge difficulty-easy">
              Easy
            </span>
          </div>
          <span id="answeredCount" class="text-sm font-semibold px-3 py-1 rounded-full bg-gray-100">
            Answered: 0
          </span>
        </div>
        <div class="progress-container">
          <div id="progressFill" class="progress-fill" style="width: 3.33%"></div>
        </div>
      </div>

      <!-- Question Card -->
      <div id="questionCard" class="question-card p-5 md:p-7 mb-4">
        <div class="flex flex-wrap items-center justify-between gap-2 mb-4">
          <span id="categoryBadge" class="category-badge">Introduction</span>
          <button id="uncheckBtn" onclick="uncheckAnswer()" class="uncheck-btn hidden">
            Clear Answer
          </button>
        </div>
        <h2 id="questionText" class="text-lg md:text-xl font-bold mb-5 leading-relaxed">
          Loading question...
        </h2>
        <div id="optionsContainer" class="space-y-2">
          <!-- Options inserted here -->
        </div>
      </div>

      <!-- Navigation Buttons -->
      <div class="flex items-center justify-between mb-4">
        <button id="prevBtn" onclick="prevQuestion()" class="btn-nav" disabled>
          Previous
        </button>
        <button id="nextBtn" onclick="nextQuestion()" class="btn-nav">
          Next
        </button>
      </div>

      <!-- Navigation Grid -->
      <div class="bg-white rounded-2xl p-4 shadow-sm">
        <div class="flex items-center justify-between mb-3">
          <span class="text-sm font-bold text-gray-600">Question Navigator</span>
          <div class="flex items-center gap-4">
            <div class="legend-item">
              <div class="legend-dot" style="background: linear-gradient(135deg, #74B9FF, #0984E3);"></div>
              <span>Answered</span>
            </div>
            <div class="legend-item">
              <div class="legend-dot" style="background: linear-gradient(135deg, var(--accent), #F78361);"></div>
              <span>Current</span>
            </div>
          </div>
        </div>
        <div id="navGrid" class="nav-grid">
          <!-- Navigation buttons inserted here -->
        </div>
      </div>

      <!-- Submit Button -->
      <div class="text-center mt-5">
        <button id="submitBtn" onclick="confirmSubmit()" class="btn-primary">
          Submit Test
        </button>
        <p class="text-xs text-gray-400 mt-2">
          Make sure you've answered all questions before submitting
        </p>
      </div>
    </div>
  </div>

  <!-- Result Screen -->
  <div id="resultScreen" class="screen">
    <div class="max-w-lg mx-auto pt-4 md:pt-10">
      <div class="result-card p-6 md:p-8">
        <h1 class="title-font text-2xl md:text-3xl font-bold mb-5" style="color: var(--fg);">
          Test Complete!
        </h1>
        
        <div class="score-circle mb-4">
          <div class="score-inner">
            <div id="finalScore" class="score-value">0</div>
            <div class="text-sm font-bold text-gray-400">/ 30</div>
          </div>
        </div>
        
        <div id="levelBadge" class="level-badge level-beginner mb-5">
          Beginner
        </div>

        <!-- Stats -->
        <div class="stats-grid mb-5">
          <div class="stat-card">
            <div class="stat-value" style="color: var(--correct);" id="correctCount">0</div>
            <div class="stat-label">Correct</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" style="color: var(--wrong);" id="wrongCount">0</div>
            <div class="stat-label">Wrong</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" style="color: var(--hots);" id="hotsScore">0/10</div>
            <div class="stat-label">HOTS Score</div>
          </div>
        </div>

        <div class="bg-gray-50 rounded-xl p-4 text-left mb-5">
          <h3 class="title-font font-bold text-base mb-2" style="color: var(--accent);">
            What your score means:
          </h3>
          <p id="levelDescription" class="text-gray-600 text-sm leading-relaxed">
            Keep practicing!
          </p>
        </div>

        <div class="space-y-2">
          <button onclick="showAnswers()" class="btn-secondary w-full">
            Review All Answers
          </button>
          <button onclick="restartQuiz()" class="btn-outline w-full">
            Try Again (New Questions)
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Answers Review Screen -->
  <div id="answersScreen" class="screen">
    <div class="max-w-2xl mx-auto pt-4 md:pt-6 pb-16">
      <div class="flex items-center justify-between mb-5">
        <h1 class="title-font text-xl md:text-2xl font-bold" style="color: var(--fg);">
          Answer Review
        </h1>
        <button onclick="showScreen('result')" class="btn-outline text-xs py-2 px-3">
          Back to Result
        </button>
      </div>
      <div id="answersContainer" class="space-y-3">
        <!-- Answers inserted here -->
      </div>
    </div>
  </div>

  <!-- Confirm Submit Modal -->
  <div id="submitModal" class="modal-overlay">
    <div class="modal-content text-center">
      <div class="text-4xl mb-3">‚ö†Ô∏è</div>
      <h3 class="title-font text-xl font-bold mb-2">Submit Test?</h3>
      <p class="text-gray-600 text-sm mb-4">
        You have answered <span id="modalAnsweredCount" class="font-bold">0</span> out of 30 questions.
        <br>You cannot change your answers after submitting.
      </p>
      <div class="flex gap-3 justify-center">
        <button onclick="closeModal()" class="btn-outline">
          Go Back
        </button>
        <button onclick="submitTest()" class="btn-primary">
          Submit Now
        </button>
      </div>
    </div>
  </div>

  <script>
    // ==================== QUESTION BANK (50 Questions) ====================
    const questionBank = [
      // ========== EASY QUESTIONS (20) ==========
      {
        category: "Introduction",
        difficulty: "easy",
        question: "Hello! My name is Rini. What is your name?",
        options: ["I am fine.", "My name is Budi.", "I am 10 years old.", "Good morning."],
        correct: 1,
        explanation: "When someone asks your name, tell them your name!"
      },
      {
        category: "Introduction",
        difficulty: "easy",
        question: "How are you today?",
        options: ["I am happy.", "My name is Tom.", "I live in Jakarta.", "Nice to meet you."],
        correct: 0,
        explanation: "'How are you?' asks about your feeling."
      },
      {
        category: "Introduction",
        difficulty: "easy",
        question: "Where do you come from?",
        options: ["I like pizza.", "I am a student.", "I come from Indonesia.", "It is sunny."],
        correct: 2,
        explanation: "Tell your country when someone asks where you come from."
      },
      {
        category: "Introduction",
        difficulty: "easy",
        question: "How old are you?",
        options: ["I am in Grade 5.", "I am ten years old.", "I am good.", "That is my book."],
        correct: 1,
        explanation: "'How old' asks about your age."
      },
      {
        category: "Introduction",
        difficulty: "easy",
        question: "Nice to meet you!",
        options: ["Thank you.", "Nice to meet you, too.", "Goodbye.", "See you later."],
        correct: 1,
        explanation: "When someone says 'Nice to meet you', say it back!"
      },
      {
        category: "Basic Needs",
        difficulty: "easy",
        question: "Excuse me, where is the toilet?",
        options: ["It is over there.", "It is five dollars.", "It is delicious.", "It is big."],
        correct: 0,
        explanation: "'Where' asks about a place or location."
      },
      {
        category: "Basic Needs",
        difficulty: "easy",
        question: "I am very thirsty. I want to drink...",
        options: ["bread.", "water.", "fried rice.", "noodle."],
        correct: 1,
        explanation: "When you are thirsty, you need water to drink."
      },
      {
        category: "Basic Needs",
        difficulty: "easy",
        question: "I feel sick. I need to see a...",
        options: ["teacher.", "driver.", "doctor.", "pilot."],
        correct: 2,
        explanation: "A doctor helps you when you are sick."
      },
      {
        category: "Basic Needs",
        difficulty: "easy",
        question: "I am hungry. I want to eat...",
        options: ["water.", "juice.", "rice.", "milk."],
        correct: 2,
        explanation: "When you are hungry, you need food like rice."
      },
      {
        category: "Restaurant",
        difficulty: "easy",
        question: "Waiter: Here is your orange juice. Customer: ...",
        options: ["I don't like it.", "Thank you.", "Where is the menu?", "I want more."],
        correct: 1,
        explanation: "Always say 'Thank you' when you get something."
      },
      {
        category: "Restaurant",
        difficulty: "easy",
        question: "I want to order fried chicken. What do I say?",
        options: ["I like chicken.", "Can I have fried chicken?", "Chicken is good.", "Where is the chicken?"],
        correct: 1,
        explanation: "Use 'Can I have...' to order food politely."
      },
      {
        category: "Hotel",
        difficulty: "easy",
        question: "I want to sleep. Where is my...?",
        options: ["table", "chair", "bed", "door"],
        correct: 2,
        explanation: "You sleep on a bed."
      },
      {
        category: "Hotel",
        difficulty: "easy",
        question: "Good night. I am going to... now.",
        options: ["eat", "sleep", "swim", "run"],
        correct: 1,
        explanation: "'Good night' is said before you go to sleep."
      },
      {
        category: "Shopping",
        difficulty: "easy",
        question: "How much is this book?",
        options: ["It is blue.", "It is twenty thousand.", "It is big.", "It is new."],
        correct: 1,
        explanation: "'How much' asks about the price."
      },
      {
        category: "Shopping",
        difficulty: "easy",
        question: "I want to buy a pencil. Where do I go?",
        options: ["Restaurant", "Hotel", "Bookstore", "Hospital"],
        correct: 2,
        explanation: "You buy pencils at a bookstore or stationery shop."
      },
      {
        category: "Directions",
        difficulty: "easy",
        question: "Go straight and turn...",
        options: ["blue", "happy", "left", "fast"],
        correct: 2,
        explanation: "'Turn left' or 'turn right' are directions."
      },
      {
        category: "Travel",
        difficulty: "easy",
        question: "We fly to Singapore by...",
        options: ["car", "bus", "plane", "train"],
        correct: 2,
        explanation: "We use a plane to fly to another country."
      },
      {
        category: "Travel",
        difficulty: "easy",
        question: "Where is the airport?",
        options: ["Over there.", "It is big.", "I like it.", "At 7 o'clock."],
        correct: 0,
        explanation: "Someone will point to the direction."
      },
      {
        category: "Travel",
        difficulty: "easy",
        question: "I need my passport. Where is it?",
        options: ["In my bag.", "It is blue.", "I like it.", "Thank you."],
        correct: 0,
        explanation: "We keep passport in a bag for safety."
      },
      {
        category: "Travel",
        difficulty: "easy",
        question: "The plane is here. Let's get...",
        options: ["out", "off", "on", "away"],
        correct: 2,
        explanation: "'Get on' means to enter a plane or bus."
      },
      
      // ========== MEDIUM QUESTIONS (20) ==========
      {
        category: "Introduction",
        difficulty: "medium",
        question: "What is your hobby?",
        options: ["I am 11 years old.", "I like reading books.", "I come from Bali.", "I am fine."],
        correct: 1,
        explanation: "A hobby is something you like to do, like reading."
      },
      {
        category: "Introduction",
        difficulty: "medium",
        question: "Can you speak English?",
        options: ["Yes, a little.", "Yes, I do.", "No, I am not.", "Yes, I can speak."],
        correct: 0,
        explanation: "'Can you...?' is answered with 'Yes, I can' or 'Yes, a little'."
      },
      {
        category: "Introduction",
        difficulty: "medium",
        question: "Excuse me, what time is it now?",
        options: ["It is sunny.", "It is 3 o'clock.", "It is Monday.", "It is morning."],
        correct: 1,
        explanation: "'What time' asks for the hour."
      },
      {
        category: "Basic Needs",
        difficulty: "medium",
        question: "I lost my bag. Can you help me find it?",
        options: ["Sure, what color is it?", "Thank you.", "You are welcome.", "I don't know."],
        correct: 0,
        explanation: "To help find something, ask for details like color."
      },
      {
        category: "Basic Needs",
        difficulty: "medium",
        question: "It is very hot today. I need...",
        options: ["a jacket.", "an umbrella.", "a fan.", "a scarf."],
        correct: 2,
        explanation: "A fan helps you cool down when it is hot."
      },
      {
        category: "Restaurant",
        difficulty: "medium",
        question: "Waiter: What would you like to drink? Customer: ...",
        options: ["I would like some soup.", "I want a chair.", "Can I have orange juice?", "I am not hungry."],
        correct: 2,
        explanation: "Answer the drink question with a drink like orange juice."
      },
      {
        category: "Restaurant",
        difficulty: "medium",
        question: "Is the food spicy?",
        options: ["Yes, it is.", "Yes, I do.", "No, I am not.", "Yes, they are."],
        correct: 0,
        explanation: "Use 'Yes, it is' to answer about food."
      },
      {
        category: "Restaurant",
        difficulty: "medium",
        question: "Can I see the menu, please?",
        options: ["Yes, please sit down.", "Here you are.", "It is delicious.", "Five dollars."],
        correct: 1,
        explanation: "The waiter gives you the menu with 'Here you are'."
      },
      {
        category: "Hotel",
        difficulty: "medium",
        question: "Good afternoon. I want to check-in.",
        options: ["What is your name?", "Where is the toilet?", "Do you have a reservation?", "Goodbye."],
        correct: 2,
        explanation: "The hotel staff will ask if you have a reservation."
      },
      {
        category: "Hotel",
        difficulty: "medium",
        question: "The AC in my room is not working. Can you fix it?",
        options: ["I am sorry. We will fix it soon.", "Thank you.", "The room is nice.", "I like it."],
        correct: 0,
        explanation: "Hotel staff will apologize and fix the problem."
      },
      {
        category: "Shopping",
        difficulty: "medium",
        question: "That bag is too expensive. Do you have a cheaper one?",
        options: ["Yes, this one is cheaper.", "It is beautiful.", "I like bags.", "Where are you going?"],
        correct: 0,
        explanation: "A shop assistant will show you a cheaper option."
      },
      {
        category: "Shopping",
        difficulty: "medium",
        question: "Can I pay with a credit card?",
        options: ["Yes, we accept credit cards.", "It is ten dollars.", "Here is your change.", "Thank you."],
        correct: 0,
        explanation: "'Accept' means the shop allows that payment method."
      },
      {
        category: "Directions",
        difficulty: "medium",
        question: "Excuse me, how do I get to the train station?",
        options: ["Turn left, then go straight.", "It is a big station.", "I like trains.", "The train is fast."],
        correct: 0,
        explanation: "Give directions when someone asks 'how do I get there'."
      },
      {
        category: "Directions",
        difficulty: "medium",
        question: "Is the bank far from here?",
        options: ["No, it is near.", "Yes, I have money.", "It is a big bank.", "I don't know."],
        correct: 0,
        explanation: "'Far' means a long distance, 'near' means close."
      },
      {
        category: "Travel",
        difficulty: "medium",
        question: "What time is our flight?",
        options: ["At 9 o'clock in the morning.", "It is a big plane.", "I like flying.", "We are late."],
        correct: 0,
        explanation: "Flight time tells you when the plane leaves."
      },
      {
        category: "Travel",
        difficulty: "medium",
        question: "Don't forget to bring your luggage.",
        options: ["Thank you for reminding me.", "I don't like it.", "Where is the toilet?", "I am hungry."],
        correct: 0,
        explanation: "Luggage is your bags and suitcases."
      },
      {
        category: "Travel",
        difficulty: "medium",
        question: "We are at the boarding gate now.",
        options: ["Let's wait for our flight.", "I want to eat.", "Where is the hotel?", "Good morning."],
        correct: 0,
        explanation: "The boarding gate is where you wait before getting on the plane."
      },
      {
        category: "Travel",
        difficulty: "medium",
        question: "The bus is full. We need to wait for the next one.",
        options: ["Okay, let's wait.", "I like buses.", "The bus is blue.", "Thank you."],
        correct: 0,
        explanation: "'Full' means there is no more space."
      },
      {
        category: "Restaurant",
        difficulty: "medium",
        question: "Do you want to order dessert?",
        options: ["Yes, I want ice cream please.", "I am not thirsty.", "The food is good.", "Where is the toilet?"],
        correct: 0,
        explanation: "Dessert is sweet food like ice cream or cake."
      },
      {
        category: "Hotel",
        difficulty: "medium",
        question: "What time is breakfast at this hotel?",
        options: ["From 7 to 10 in the morning.", "It is delicious.", "I like breakfast.", "In the restaurant."],
        correct: 0,
        explanation: "Hotels serve breakfast at specific hours."
      },
      
      // ========== HARD/HOTS QUESTIONS (10) ==========
      {
        category: "HOTS - Situational",
        difficulty: "hard",
        question: "You are at a restaurant. You ordered chicken, but the waiter brings fish. What should you say?",
        options: [
          "I don't like fish.",
          "Excuse me, I ordered chicken, not fish.",
          "This is delicious.",
          "I want to go home."
        ],
        correct: 1,
        explanation: "Politely explain the mistake. Use 'Excuse me' and state what you ordered."
      },
      {
        category: "HOTS - Situational",
        difficulty: "hard",
        question: "You are lost in Singapore. You want to go to the hotel but you don't know the way. What is the best question?",
        options: [
          "Where is the hotel?",
          "Excuse me, can you show me the way to my hotel? The name is Marina Hotel.",
          "I am lost.",
          "Do you know the hotel?"
        ],
        correct: 1,
        explanation: "Give the hotel name so people can help you better. Be polite with 'Excuse me'."
      },
      {
        category: "HOTS - Situational",
        difficulty: "hard",
        question: "Your friend says 'I have a stomachache.' What is the best thing to say?",
        options: [
          "That is bad.",
          "I am sorry to hear that. You should rest and drink warm water.",
          "I have a stomachache too.",
          "Let's play games."
        ],
        correct: 1,
        explanation: "Show empathy (I'm sorry) and give helpful advice."
      },
      {
        category: "HOTS - Situational",
        difficulty: "hard",
        question: "You are at the airport. The announcement says your flight is delayed. What does this mean?",
        options: [
          "The flight is cancelled.",
          "The flight will leave earlier.",
          "The flight will leave later than the scheduled time.",
          "The flight is on time."
        ],
        correct: 2,
        explanation: "'Delayed' means the flight will leave later than planned."
      },
      {
        category: "HOTS - Situational",
        difficulty: "hard",
        question: "A shop assistant asks 'Would you like a receipt?' You don't need it. What do you say?",
        options: [
          "I don't want it.",
          "No, thank you.",
          "What is a receipt?",
          "Give me the money."
        ],
        correct: 1,
        explanation: "Politely refuse with 'No, thank you' when you don't need something."
      },
      {
        category: "HOTS - Situational",
        difficulty: "hard",
        question: "You want to buy a souvenir but you think the price is too high. What should you say?",
        options: [
          "This is expensive!",
          "I don't have money.",
          "Can you give me a lower price?",
          "I don't want it."
        ],
        correct: 2,
        explanation: "In many countries, you can ask for a discount politely."
      },
      {
        category: "HOTS - Situational",
        difficulty: "hard",
        question: "At the hotel, the receptionist says 'Your room is on the 5th floor.' What should you ask next?",
        options: [
          "Where is the lift?",
          "I like the room.",
          "The room is big.",
          "How much is it?"
        ],
        correct: 0,
        explanation: "A lift (elevator) takes you to higher floors."
      },
      {
        category: "HOTS - Situational",
        difficulty: "hard",
        question: "You are at the immigration counter. The officer asks 'What is the purpose of your visit?' What do you answer?",
        options: [
          "I am happy.",
          "I am here for a holiday.",
          "I don't know.",
          "I like this country."
        ],
        correct: 1,
        explanation: "The officer wants to know why you are visiting (holiday, work, study)."
      },
      {
        category: "HOTS - Situational",
        difficulty: "hard",
        question: "Your flight leaves at 3 PM. It is now 2 PM. The airport is 1 hour away. What should you do?",
        options: [
          "Take your time.",
          "Go to the airport now. You might be late.",
          "Eat lunch first.",
          "Go shopping."
        ],
        correct: 1,
        explanation: "You must arrive at the airport early, so leave immediately."
      },
      {
        category: "HOTS - Situational",
        difficulty: "hard",
        question: "At a restaurant, the waiter asks 'How would you like your steak?' What is he asking?",
        options: [
          "How much you want to pay.",
          "How you want it cooked (rare, medium, or well done).",
          "What sauce you want.",
          "What drink you want."
        ],
        correct: 1,
        explanation: "Steak can be cooked rare (red inside), medium (pink), or well done (fully cooked)."
      }
    ];

    // ==================== STATE ====================
    let currentQuestion = 0;
    let activeQuestions = [];
    let userAnswers = []; // Stores selected option index for each question
    let submitted = false;
    let score = 0;
    let hotsCorrect = 0;

    // ==================== DOM ELEMENTS ====================
    const startScreen = document.getElementById('startScreen');
    const quizScreen = document.getElementById('quizScreen');
    const resultScreen = document.getElementById('resultScreen');
    const answersScreen = document.getElementById('answersScreen');
    const questionCard = document.getElementById('questionCard');
    const questionText = document.getElementById('questionText');
    const optionsContainer = document.getElementById('optionsContainer');
    const categoryBadge = document.getElementById('categoryBadge');
    const difficultyIndicator = document.getElementById('difficultyIndicator');
    const currentNum = document.getElementById('currentNum');
    const progressFill = document.getElementById('progressFill');
    const answeredCount = document.getElementById('answeredCount');
    const navGrid = document.getElementById('navGrid');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const uncheckBtn = document.getElementById('uncheckBtn');
    const submitBtn = document.getElementById('submitBtn');
    const submitModal = document.getElementById('submitModal');
    const modalAnsweredCount = document.getElementById('modalAnsweredCount');

    // ==================== UTILITY FUNCTIONS ====================
    
    function shuffleArray(array) {
      const arr = [...array];
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    function pickQuestions() {
      const easyQ = shuffleArray(questionBank.filter(q => q.difficulty === 'easy')).slice(0, 10);
      const mediumQ = shuffleArray(questionBank.filter(q => q.difficulty === 'medium')).slice(0, 10);
      const hardQ = shuffleArray(questionBank.filter(q => q.difficulty === 'hard')).slice(0, 10);
      return shuffleArray([...easyQ, ...mediumQ, ...hardQ]);
    }

    function shuffleOptions(question) {
      const optionObjs = question.options.map((opt, idx) => ({
        text: opt,
        isCorrect: idx === question.correct
      }));
      
      const shuffled = shuffleArray(optionObjs);
      const newCorrect = shuffled.findIndex(o => o.isCorrect);
      
      return {
        ...question,
        options: shuffled.map(o => o.text),
        correct: newCorrect
      };
    }

    // ==================== SCREEN MANAGEMENT ====================
    
    function showScreen(screen) {
      startScreen.classList.remove('active');
      quizScreen.classList.remove('active');
      resultScreen.classList.remove('active');
      answersScreen.classList.remove('active');
      
      if (screen === 'start') startScreen.classList.add('active');
      if (screen === 'quiz') quizScreen.classList.add('active');
      if (screen === 'result') resultScreen.classList.add('active');
      if (screen === 'answers') answersScreen.classList.add('active');
    }

    // ==================== QUIZ FUNCTIONS ====================
    
    function startQuiz() {
      currentQuestion = 0;
      userAnswers = new Array(30).fill(null);
      submitted = false;
      score = 0;
      hotsCorrect = 0;
      
      const picked = pickQuestions();
      activeQuestions = picked.map(q => shuffleOptions(q));
      
      showScreen('quiz');
      createNavGrid();
      loadQuestion();
    }

    function createNavGrid() {
      navGrid.innerHTML = '';
      for (let i = 0; i < 30; i++) {
        const btn = document.createElement('button');
        btn.className = 'nav-btn';
        btn.textContent = i + 1;
        btn.onclick = () => goToQuestion(i);
        navGrid.appendChild(btn);
      }
      updateNavGrid();
    }

    function updateNavGrid() {
      const buttons = navGrid.querySelectorAll('.nav-btn');
      buttons.forEach((btn, idx) => {
        btn.classList.remove('current', 'answered', 'correct-answer', 'wrong-answer');
        
        if (submitted) {
          // After submission, show correct/wrong
          if (userAnswers[idx] === activeQuestions[idx].correct) {
            btn.classList.add('correct-answer');
          } else {
            btn.classList.add('wrong-answer');
          }
        } else {
          // Before submission, show answered/current
          if (idx === currentQuestion) {
            btn.classList.add('current');
          } else if (userAnswers[idx] !== null) {
            btn.classList.add('answered');
          }
        }
      });
    }

    function loadQuestion() {
      const q = activeQuestions[currentQuestion];
      
      // Update header
      currentNum.textContent = currentQuestion + 1;
      progressFill.style.width = ((currentQuestion + 1) / activeQuestions.length * 100) + '%';
      
      // Update answered count
      const answered = userAnswers.filter(a => a !== null).length;
      answeredCount.textContent = 'Answered: ' + answered;
      
      // Update category and difficulty
      categoryBadge.textContent = q.category;
      
      difficultyIndicator.className = 'difficulty-badge difficulty-' + q.difficulty;
      let diffText = q.difficulty.charAt(0).toUpperCase() + q.difficulty.slice(1);
      if (q.difficulty === 'hard') diffText = 'HOTS';
      difficultyIndicator.textContent = diffText;
      
      // Update question
      questionText.textContent = q.question;
      
      // Create options
      optionsContainer.innerHTML = '';
      const labels = ['A', 'B', 'C', 'D'];
      
      q.options.forEach((opt, idx) => {
        const btn = document.createElement('button');
        btn.className = 'option-btn w-full flex items-center';
        
        if (submitted) {
          if (idx === q.correct) {
            btn.classList.add('correct');
          } else if (idx === userAnswers[currentQuestion]) {
            btn.classList.add('wrong');
          }
        } else if (userAnswers[currentQuestion] === idx) {
          btn.classList.add('selected');
        }
        
        btn.innerHTML = `
          <span class="option-label">${labels[idx]}</span>
          <span>${opt}</span>
        `;
        
        if (!submitted) {
          btn.onclick = () => selectAnswer(idx);
        } else {
          btn.disabled = true;
        }
        
        optionsContainer.appendChild(btn);
      });
      
      // Update uncheck button visibility
      if (!submitted && userAnswers[currentQuestion] !== null) {
        uncheckBtn.classList.remove('hidden');
      } else {
        uncheckBtn.classList.add('hidden');
      }
      
      // Update navigation buttons
      prevBtn.disabled = currentQuestion === 0;
      if (currentQuestion === activeQuestions.length - 1) {
        nextBtn.textContent = 'Submit';
        nextBtn.onclick = confirmSubmit;
      } else {
        nextBtn.textContent = 'Next';
        nextBtn.onclick = nextQuestion;
      }
      
      // Update nav grid
      updateNavGrid();
      
      // Animate card
      questionCard.style.animation = 'none';
      questionCard.offsetHeight;
      questionCard.style.animation = 'cardSlideUp 0.5s cubic-bezier(0.4, 0, 0.2, 1) forwards';
    }

    function selectAnswer(idx) {
      if (submitted) return;
      
      userAnswers[currentQuestion] = idx;
      
      // Update UI
      const buttons = optionsContainer.querySelectorAll('.option-btn');
      buttons.forEach((btn, i) => {
        btn.classList.remove('selected');
        if (i === idx) {
          btn.classList.add('selected');
        }
      });
      
      // Show uncheck button
      uncheckBtn.classList.remove('hidden');
      
      // Update answered count
      const answered = userAnswers.filter(a => a !== null).length;
      answeredCount.textContent = 'Answered: ' + answered;
      
      // Update nav grid
      updateNavGrid();
    }

    function uncheckAnswer() {
      if (submitted) return;
      
      userAnswers[currentQuestion] = null;
      
      // Update UI
      const buttons = optionsContainer.querySelectorAll('.option-btn');
      buttons.forEach(btn => btn.classList.remove('selected'));
      
      // Hide uncheck button
      uncheckBtn.classList.add('hidden');
      
      // Update answered count
      const answered = userAnswers.filter(a => a !== null).length;
      answeredCount.textContent = 'Answered: ' + answered;
      
      // Update nav grid
      updateNavGrid();
    }

    function goToQuestion(idx) {
      currentQuestion = idx;
      loadQuestion();
    }

    function prevQuestion() {
      if (currentQuestion > 0) {
        currentQuestion--;
        loadQuestion();
      }
    }

    function nextQuestion() {
      if (currentQuestion < activeQuestions.length - 1) {
        currentQuestion++;
        loadQuestion();
      }
    }

    // ==================== SUBMIT FUNCTIONS ====================
    
    function confirmSubmit() {
      const answered = userAnswers.filter(a => a !== null).length;
      modalAnsweredCount.textContent = answered;
      submitModal.classList.add('active');
    }

    function closeModal() {
      submitModal.classList.remove('active');
    }

    function submitTest() {
      closeModal();
      submitted = true;
      
      // Calculate score
      score = 0;
      hotsCorrect = 0;
      
      userAnswers.forEach((ans, idx) => {
        if (ans === activeQuestions[idx].correct) {
          score++;
          if (activeQuestions[idx].difficulty === 'hard') {
            hotsCorrect++;
          }
        }
      });
      
      // Show result
      showResult();
    }

    // ==================== RESULT FUNCTIONS ====================
    
    function showResult() {
      showScreen('result');
      
      // Animate score
      let count = 0;
      const target = score;
      const interval = setInterval(() => {
        count++;
        document.getElementById('finalScore').textContent = count;
        if (count >= target) clearInterval(interval);
      }, 50);
      
      // Stats
      const wrong = activeQuestions.length - score;
      document.getElementById('correctCount').textContent = score;
      document.getElementById('wrongCount').textContent = wrong;
      document.getElementById('hotsScore').textContent = hotsCorrect + '/10';
      
      // Set level
      let level, levelClass, description;
      const percentage = (score / activeQuestions.length) * 100;
      
      if (percentage >= 90) {
        level = 'Expert';
        levelClass = 'level-expert';
        description = 'Amazing! You are a star! You can handle any situation in English. You are ready for your immersion program!';
      } else if (percentage >= 75) {
        level = 'Advanced';
        levelClass = 'level-advanced';
        description = 'Excellent work! You can communicate well in English. Keep practicing to be even better!';
      } else if (percentage >= 50) {
        level = 'Intermediate';
        levelClass = 'level-intermediate';
        description = 'Good job! You know many English words and phrases. Practice more conversations about travel!';
      } else if (percentage >= 25) {
        level = 'Basic';
        levelClass = 'level-basic';
        description = 'You are learning! Focus on simple words for restaurants, hotels, and directions. You can do it!';
      } else {
        level = 'Beginner';
        levelClass = 'level-beginner';
        description = 'Keep trying! Learn more simple words and practice with friends. Every expert was once a beginner!';
      }
      
      const levelBadge = document.getElementById('levelBadge');
      levelBadge.textContent = level;
      levelBadge.className = 'level-badge ' + levelClass;
      document.getElementById('levelDescription').textContent = description;
      
      // Confetti for good scores
      if (percentage >= 50) {
        createConfetti();
      }
    }

    function createConfetti() {
      const colors = ['#E17055', '#00B894', '#FDCB6E', '#6C5CE7', '#74B9FF', '#FD79A8'];
      
      for (let i = 0; i < 50; i++) {
        setTimeout(() => {
          const confetti = document.createElement('div');
          confetti.className = 'confetti';
          
          const size = Math.random() * 10 + 6;
          const color = colors[Math.floor(Math.random() * colors.length)];
          
          confetti.style.left = Math.random() * 100 + 'vw';
          confetti.style.width = size + 'px';
          confetti.style.height = size + 'px';
          confetti.style.background = color;
          confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '2px';
          confetti.style.animationDuration = (Math.random() * 2 + 3) + 's';
          
          document.body.appendChild(confetti);
          setTimeout(() => confetti.remove(), 5000);
        }, i * 50);
      }
    }

    // ==================== ANSWERS REVIEW ====================
    
    function showAnswers() {
      showScreen('answers');
      const answersContainer = document.getElementById('answersContainer');
      answersContainer.innerHTML = '';
      
      const labels = ['A', 'B', 'C', 'D'];
      
      activeQuestions.forEach((q, idx) => {
        const userAns = userAnswers[idx];
        const isCorrect = userAns === q.correct;
        const diffColors = {
          easy: { bg: 'bg-green-100', text: 'text-green-700' },
          medium: { bg: 'bg-yellow-100', text: 'text-yellow-700' },
          hard: { bg: 'bg-purple-100', text: 'text-purple-700' }
        };
        const colors = diffColors[q.difficulty];
        
        const card = document.createElement('div');
        card.className = 'bg-white rounded-xl p-4 shadow-sm border-2 ' + (isCorrect ? 'border-green-200' : 'border-red-200');
        
        card.innerHTML = `
          <div class="flex items-start gap-3 mb-3">
            <span class="flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center text-white font-bold text-sm ${isCorrect ? 'bg-green-500' : 'bg-red-400'}">
              ${idx + 1}
            </span>
            <div class="flex-1">
              <div class="flex flex-wrap items-center gap-2 mb-1">
                <span class="text-xs font-bold uppercase ${colors.text} ${colors.bg} px-2 py-0.5 rounded-full">
                  ${q.difficulty === 'hard' ? 'HOTS' : q.difficulty}
                </span>
                <span class="text-xs text-gray-500">${q.category}</span>
              </div>
              <p class="font-semibold text-gray-800 text-sm">${q.question}</p>
            </div>
          </div>
          <div class="ml-11 space-y-1">
            <p class="text-sm">
              <span class="text-gray-500">Your answer:</span>
              <span class="${isCorrect ? 'text-green-600' : 'text-red-600'} font-semibold ml-1">
                ${userAns !== null ? labels[userAns] + '. ' + q.options[userAns] : 'Not answered'}
              </span>
              ${isCorrect ? '<span class="ml-1">‚úì</span>' : ''}
            </p>
            ${!isCorrect ? `
              <p class="text-sm">
                <span class="text-gray-500">Correct answer:</span>
                <span class="text-green-600 font-semibold ml-1">
                  ${labels[q.correct]}. ${q.options[q.correct]}
                </span>
              </p>
            ` : ''}
            <div class="bg-gray-50 rounded-lg p-2 mt-2">
              <p class="text-xs text-gray-600">
                <span class="font-semibold text-gray-700">Explanation:</span> ${q.explanation}
              </p>
            </div>
          </div>
        `;
        answersContainer.appendChild(card);
      });
    }

    function restartQuiz() {
      showScreen('start');
    }

    // ==================== KEYBOARD SUPPORT ====================
    
    document.addEventListener('keydown', (e) => {
      if (quizScreen.classList.contains('active') && !submitted) {
        const key = e.key.toUpperCase();
        if (['A', 'B', 'C', 'D'].includes(key)) {
          const idx = ['A', 'B', 'C', 'D'].indexOf(key);
          selectAnswer(idx);
        } else if (e.key === 'ArrowLeft') {
          prevQuestion();
        } else if (e.key === 'ArrowRight') {
          nextQuestion();
        }
      }
    });

    // Close modal on click outside
    submitModal.addEventListener('click', (e) => {
      if (e.target === submitModal) {
        closeModal();
      }
    });
  </script>
</body>
</html>
